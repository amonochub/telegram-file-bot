#!/usr/bin/env python3
"""
Demo script for Enhanced Analyzer
–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞
"""

import asyncio
import json
from app.services.enhanced_analyzer import analyze_document, get_analyzer_stats


async def demo_enhanced_analyzer():
    """–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞"""
    print("üîç Demo Enhanced Analyzer - –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞")
    print("=" * 80)
    
    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞
    stats = get_analyzer_stats()
    print("\nüìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞:")
    for key, value in stats.items():
        print(f"   {key}: {value}")
    
    # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
    test_documents = [
        {
            "name": "–°—á–µ—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É",
            "content": """
            –°–ß–ï–¢ –ù–ê –û–ü–õ–ê–¢–£ ‚ÑñINV-2024-001
            
            –û—Ç: –û–û–û "–†–æ–≥–∞ –∏ –ö–æ–ø—ã—Ç–∞"
            –ò–ù–ù: 1234567890
            –ö–ü–ü: 123456789
            –†–∞—Å—á–µ—Ç–Ω—ã–π —Å—á–µ—Ç: 40702810123456789012
            –ë–ò–ö: 044525225
            
            –ö –æ–ø–ª–∞—Ç–µ: 250,500.75 EUR
            –î–∞—Ç–∞ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è: 15.03.2024
            –î–∞—Ç–∞ –æ–ø–ª–∞—Ç—ã: –¥–æ 01.04.2024
            
            IBAN: DE89370400440532013000
            SWIFT: DEUTDEFF
            
            –ö–æ–Ω—Ç–∞–∫—Ç—ã:
            Email: accounting@example.com
            –¢–µ–ª–µ—Ñ–æ–Ω: +7 (495) 123-45-67
            """
        },
        {
            "name": "–î–æ–≥–æ–≤–æ—Ä –ø–æ—Å—Ç–∞–≤–∫–∏",
            "content": """
            –î–û–ì–û–í–û–† –ü–û–°–¢–ê–í–ö–ò ‚ÑñCON-2024-789
            
            –ó–∞–∫–∞–∑—á–∏–∫: –ü–ê–û "–ì–∞–∑–ø—Ä–æ–º"
            –û–ì–†–ù: 1027700070518
            –ò–ù–ù: 7736050003
            
            –ü–æ—Å—Ç–∞–≤—â–∏–∫: –û–û–û "–°–µ—Ä–≤–∏—Å+"
            –û–ì–†–ù: 1234567890123
            
            –ü—Ä–µ–¥–º–µ—Ç –¥–æ–≥–æ–≤–æ—Ä–∞: –ü–æ—Å—Ç–∞–≤–∫–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
            –°—É–º–º–∞ –¥–æ–≥–æ–≤–æ—Ä–∞: 1,500,000.00 RUB
            –ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã: 50%
            –®—Ç—Ä–∞—Ñ –∑–∞ –ø—Ä–æ—Å—Ä–æ—á–∫—É: 0.1% –∑–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
            
            –î–∞—Ç–∞ –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è: 01.02.2024
            –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: –¥–æ 31.12.2024
            –î–∞—Ç–∞ –ø–æ—Å—Ç–∞–≤–∫–∏: –Ω–µ –ø–æ–∑–¥–Ω–µ–µ 15.06.2024
            """
        },
        {
            "name": "–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –≤—ã–ø–∏—Å–∫–∞",
            "content": """
            –í–´–ü–ò–°–ö–ê –ü–û –°–ß–ï–¢–£
            
            –ë–∞–Ω–∫: –°–±–µ—Ä–±–∞–Ω–∫ –†–æ—Å—Å–∏–∏
            –ë–ò–ö: 044525225
            –°—á–µ—Ç: 40702810400000123456
            
            –ü–µ—Ä–∏–æ–¥: —Å 01.03.2024 –ø–æ 31.03.2024
            
            –û–ø–µ—Ä–∞—Ü–∏–∏:
            05.03.2024 - –ü–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ 100,000.00 USD –æ—Ç –û–û–û "–ü–∞—Ä—Ç–Ω–µ—Ä"
            10.03.2024 - –°–ø–∏—Å–∞–Ω–∏–µ 25,750.50 EUR –Ω–∞ –æ–ø–ª–∞—Ç—É –∏–Ω–≤–æ–π—Å–∞ ‚ÑñINV-001
            15.03.2024 - –ü–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ 500,000.00 ‚ÇΩ –æ—Ç –ø—Ä–æ–¥–∞–∂–∏
            20.03.2024 - –ö–æ–º–∏—Å—Å–∏—è –±–∞–Ω–∫–∞: 2.5%
            
            –û—Å—Ç–∞—Ç–æ–∫ –Ω–∞ –∫–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞: 1,234,567.89 RUB
            """
        }
    ]
    
    # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞–∂–¥—ã–π –¥–æ–∫—É–º–µ–Ω—Ç
    for i, doc in enumerate(test_documents, 1):
        print(f"\n{i}. üìÑ –ê–Ω–∞–ª–∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞: {doc['name']}")
        print("-" * 60)
        
        result = await analyze_document(doc['content'], f"{doc['name']}.pdf")
        
        print(f"üéØ –¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞: {result.document_type or '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'}")
        print(f"üìä –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: {result.confidence_score:.1%}")
        print(f"‚è±Ô∏è –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: {result.processing_time:.3f}s")
        print(f"üìù –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–≤: {result.word_count}")
        
        # –ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        if result.extracted_data:
            print("\nüîç –ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:")
            for param_type, values in result.extracted_data.items():
                if values:
                    print(f"   {param_type}: {values}")
        
        # –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
        if result.financial_summary and result.financial_summary.get("currencies_found"):
            print("\nüí∞ –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:")
            print(f"   –í–∞–ª—é—Ç—ã: {', '.join(result.financial_summary['currencies_found'])}")
            print(f"   –°—á–µ—Ç–æ–≤: {result.financial_summary['accounts_count']}")
            print(f"   IBAN: {result.financial_summary['ibans_count']}")
            
            if result.financial_summary.get("total_amounts_by_currency"):
                print("   –°—É–º–º—ã –ø–æ –≤–∞–ª—é—Ç–∞–º:")
                for curr, amount in result.financial_summary["total_amounts_by_currency"].items():
                    print(f"     {curr}: {amount:,.2f}")
        
        # –ê–Ω–∞–ª–∏–∑ –¥–∞—Ç
        if result.date_analysis and result.date_analysis.get("dates_count", 0) > 0:
            print("\nüìÖ –ê–Ω–∞–ª–∏–∑ –¥–∞—Ç:")
            print(f"   –ù–∞–π–¥–µ–Ω–æ –¥–∞—Ç: {result.date_analysis['dates_count']}")
            if result.date_analysis.get("date_range"):
                print(f"   –ü–µ—Ä–∏–æ–¥: {result.date_analysis['date_range']['earliest']} - {result.date_analysis['date_range']['latest']}")
                print(f"   –î–∏–∞–ø–∞–∑–æ–Ω: {result.date_analysis['date_range']['span_days']} –¥–Ω–µ–π")
        
        # –í–∞–ª—é—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
        if result.currency_operations:
            print(f"\nüí± –í–∞–ª—é—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏: {len(result.currency_operations)}")
            for op in result.currency_operations[:3]:  # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ 3
                print(f"   {op['type']}: {op.get('amount', 'N/A')}")
    
    print("\n" + "=" * 80)
    print("‚úÖ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!")
    print("\nüéì –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ Enhanced Analyzer:")
    print("   ‚Ä¢ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ 16+ —Ç–∏–ø–æ–≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (IBAN, SWIFT, –ò–ù–ù, —Ç–µ–ª–µ—Ñ–æ–Ω—ã, email)")
    print("   ‚Ä¢ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (—Å—á–µ—Ç, –¥–æ–≥–æ–≤–æ—Ä, –≤—ã–ø–∏—Å–∫–∞)")
    print("   ‚Ä¢ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ —Å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π –ø–æ –≤–∞–ª—é—Ç–∞–º")
    print("   ‚Ä¢ –ê–Ω–∞–ª–∏–∑ –¥–∞—Ç —Å –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ–º –ø–µ—Ä–∏–æ–¥–æ–≤")
    print("   ‚Ä¢ –û—Ü–µ–Ω–∫–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö")
    print("   ‚Ä¢ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ JSON-—Ñ–æ—Ä–º–∞—Ç–µ")


if __name__ == "__main__":
    asyncio.run(demo_enhanced_analyzer())